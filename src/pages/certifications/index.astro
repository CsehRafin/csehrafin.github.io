---
import PageLayout from "@layouts/PageLayout.astro";
import Container from "@components/Container.astro";
import { CERTIFICATIONS } from "@consts";
import Link from "@components/Link.astro";
import { formatDate } from "@lib/utils";

// Fetch remote certifications JSON
const response = await fetch("https://credentials.csehrafin.workers.dev/certifications.json");
if (!response.ok) {
  throw new Error("Failed to fetch certifications");
}
const certifications = await response.json();

// Sort certifications by date, most recent first
const sortedCerts = certifications.sort(
  (a, b) => new Date(b.date).valueOf() - new Date(a.date).valueOf()
);
---

<PageLayout title={CERTIFICATIONS.TITLE} description={CERTIFICATIONS.DESCRIPTION}>
  <Container>
    <div class="space-y-10">
      <div class="animate font-semibold text-black dark:text-white">
        Certifications
      </div>
      
      <ul class="animate flex flex-col divide-y divide-black/15 dark:divide-white/20">
        {
          sortedCerts.map((cert) => (
            <li class="py-6 first:pt-0 last:pb-0">
              <div class="flex flex-col">
                <div class="font-semibold text-black dark:text-white">{cert.name}</div>
                <div class="text-sm opacity-75 mt-1">{cert.issuer}</div>
                <div class="text-xs opacity-60 mt-1">{formatDate(new Date(cert.date))}</div>
                {cert.url && (
                  <div class="mt-3">
                    <a 
                      href={cert.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="inline-block px-3 py-1 text-sm font-medium text-black/60 dark:text-white/60 bg-stone-50/50 dark:bg-zinc-800/50 border border-stone-300/50 dark:border-zinc-700/50 rounded-full backdrop-blur-sm hover:bg-stone-200/75 dark:hover:bg-zinc-700/75 transition-colors duration-300"
                    >
                      View Credential
                    </a>
                  </div>
                )}
              </div>
            </li>
          ))
        }
      </ul>
    </div>
  </Container>
</PageLayout>
